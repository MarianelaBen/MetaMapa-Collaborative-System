<html th:replace="~{layout/base :: html}" xmlns:th="http://www.thymeleaf.org">

<div th:fragment="css">
    <link rel="stylesheet" th:href="@{/css/landing.css}" />
</div>

<div th:fragment="contenido">
    <div class="landing-banner">
        <h1 class="landing-title">Potenciá el Poder de los <br> Datos Geográficos</h1>
        <h5 class="landing-subtitle">MetaMapa le permite organizar, analizar y visualizar <br>
            información geoespacial como nunca antes.</h5>
        <div class="call-to-action-buttons">
            <button class="btn-signup" th:onclick="|window.location.href='@{/signup}'|">Registrarse</button>
            <button class="btn-login"  th:onclick="|window.location.href='@{/login}'|">Iniciar sesión</button>
            <a th:href="@{/colecciones}" class="btn-explorar">Explorar Colecciones</a>
        </div>
    </div>

    <section id="propositos-objetivos" aria-labelledby="pm-title" class="pm-section">
        <div class="pm-container">
            <div class="pm-left">
                <h2 id="pm-title" style="display: flex;">Nuestro Propósito<i class="fa-solid fa-location-pin pm-icon"></i></h2>
                <p class="pm-purpose">
                    MetaMapa potencia la inteligencia colectiva para transformar aportes individuales en
                    información georreferenciada y multimedia fiable. Ordenamos, etiquetamos y situamos
                    hechos en tiempo y espacio para facilitar
                    prevención, visibilización e intervención en problemáticas reales.
                </p>
                <div class="pm-img">
                    <img src="../img/mapa.jpg" alt="imagen mapa">
                </div>
            </div>

            <div class="pm-divider" aria-hidden="true"></div>

            <div class="pm-right" role="list" aria-label="Objetivos principales">
                <h2 class="pm-right-title" style="display: flex;">Nuestros Objetivos<i class="fa-solid fa-bullseye pm-icon"></i></h2>

                <article class="pm-item" role="listitem">
                    <div class="pm-icon" aria-hidden="true">
                        <i class="fa-solid fa-users fa-2x" aria-hidden="true"></i>
                    </div>
                    <div class="pm-text">
                        <h4>Facilitar la colaboración segura</h4>
                        <p>Flujos accesibles para que comunidades, ONG y organismos aporten y consensúen información
                            (anónima o registrada).</p>
                    </div>
                </article>

                <article class="pm-item" role="listitem">
                    <div class="pm-icon" aria-hidden="true">
                        <i class="fa-solid fa-shield-halved fa-2x" aria-hidden="true"></i>
                    </div>
                    <div class="pm-text">
                        <h4>Proteger identidad e integridad</h4>
                        <p>Anonimato opcional, mínima recolección de datos para visitantes y preservación de pruebas
                            multimedia.</p>
                    </div>
                </article>

                <article class="pm-item" role="listitem">
                    <div class="pm-icon" aria-hidden="true">
                        <i class="fa-solid fa-check-circle fa-2x" aria-hidden="true"></i>
                    </div>
                    <div class="pm-text">
                        <h4>Promover veracidad y consenso</h4>
                        <p>Modos de navegación y algoritmos de consenso para destacar hechos verificados por la
                            comunidad.</p>
                    </div>
                </article>

                <article class="pm-item" role="listitem">
                    <div class="pm-icon" aria-hidden="true">
                        <i class="fa-solid fa-code-branch fa-2x" aria-hidden="true"></i>
                    </div>
                    <div class="pm-text">
                        <h4>Interoperabilidad e adopción</h4>
                        <p>APIs y formatos abiertos para integrar fuentes proxy y permitir que otras instancias consuman
                            datos.</p>
                    </div>
                </article>

                <article class="pm-item" role="listitem">
                    <div class="pm-icon" aria-hidden="true">
                        <i class="fa-solid fa-globe fa-2x" aria-hidden="true"></i>
                    </div>
                    <div class="pm-text">
                        <h4>Maximizar impacto social</h4>
                        <p>Visualizaciones y exportes que permitan que los datos informen decisiones, investigaciones y
                            campañas.</p>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <!-- === MAPA INTERACTIVO (reemplaza el iframe por este div) === -->
    <div class="mapa-interactivo container">
        <div id="map"></div>
    </div>

    <div class="destacados container">
        <h2>Destacados</h2>

        <!-- TARJETAS DE COLECCIONES -->
        <div class="colecciones-destacadas">
            <div class="card coleccion-destacada" style="width: 18rem;" th:each="coleccion : ${coleccionesDestacadas}">
                <div class="card-body">
                    <h5 class="card-title" th:text="${coleccion.titulo}"></h5>
                    <p class="card-text" th:text="${coleccion.titulo}"></p>
                    <div class="collection-meta">
                        <span th:text="${coleccion.hechos.size()}"></span><br/>
                    </div>
                    <div style="margin-top:8px;">
                        <a href="#" class="btn btn-signup">Ver Hechos</a>
                        <a href="#" class="btn btn-secondary">Ver en Mapa</a>
                    </div>
                </div>
            </div>
        </div>


        <div class="hechos-destacados">

            <!-- Hecho 1: Incendio forestal -->
            <div class="hecho-destacado" th:each="hecho : ${hechosDestacados}">
                <div class="hecho-header">
                    <h3 class="hecho-title" th:text="${hecho.titulo}"></h3>
                    <div class="hecho-category category-incendio" th:text="${hecho.categoria}"></div>
                </div>
                <div class="hecho-content">
                    <p class="hecho-description" th:text="${hecho.descripcion}"></p>
                    <div class="hecho-meta d-flex gap-3 flex-wrap">
                        <div class="meta-item">
                            <span class="meta-label">Fecha</span><br/>
                            <span class="meta-value" th:text="${hecho.fechaAcontecimiento}"></span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Ubicación</span><br/>
                            <span class="meta-value" th:text="${hecho.provincia}"></span>
                        </div>
                    </div>
                </div>
                <div class="hecho-footer">
                    <button href="../hechosYColecciones/detalleHecho.html" class="btn btn-signup">Ver Detalle</button>
                    <button class="btn btn-secondary ver-en-mapa" data-id="1">Ver en Mapa</button>
                </div>
            </div>


        </div>
    </div>

    <div class="modal fade" id="detalleModal" tabindex="-1" aria-labelledby="detalleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detalleModalLabel">Detalle del Hecho</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body detalle-modal-body" id="detalleModalBody">
            <p>Cargando...</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <a id="btnIrADetalle" href="#" class="btn btn-primary">Ir a la página de detalle</a>
          </div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <script>
        // ======== HECHOS HARDCODEADOS ========
        const hechos = [
          {
            id: 1,
            titulo: 'Incendio en Parque Nacional Los Glaciares',
            descripcion: 'Incendio de gran magnitud detectado en el sector norte del Parque Nacional Los Glaciares (Santa Cruz).',
            fecha: '2025-08-12',
            ubicacion: 'Parque Nacional Los Glaciares, Santa Cruz',
            estado: 'Activo',
            actualizado: 'hace 3 min',
            lat: -49.3340,
            lng: -72.2800,
            detalleUrl: '../hechosYColecciones/detalleHecho.html'
          },
          {
            id: 2,
            titulo: 'Accidente múltiple en Ruta Nacional 9 (Rosario)',
            descripcion: 'Colisión múltiple involucrando 4 vehículos en el km 847 de la RN9.',
            fecha: '2025-08-15',
            ubicacion: 'Rosario, Santa Fe',
            estado: 'Finalizado',
            actualizado: 'hace 1 hora',
            lat: -32.9546,
            lng: -60.6939,
            detalleUrl: '#'
          },
          {
            id: 3,
            titulo: 'Derrame químico en fábrica industrial de Córdoba',
            descripcion: 'Reporte de derrame de sustancias químicas en planta industrial en las afueras de Córdoba.',
            fecha: '2025-08-10',
            ubicacion: 'Córdoba, Provincia de Córdoba',
            estado: 'En verificación',
            actualizado: 'hace 2 horas',
            lat: -31.4201,
            lng: -64.1888,
            detalleUrl: '#'
          },
          {
            id: 4,
            titulo: 'Manifestación masiva en Plaza de Mayo',
            descripcion: 'Concentración y manifestación con cortes parciales en la zona céntrica.',
            fecha: '2025-09-02',
            ubicacion: 'Ciudad Autónoma de Buenos Aires',
            estado: 'Finalizado',
            actualizado: 'hace 2 horas',
            lat: -34.6083,
            lng: -58.3712,
            detalleUrl: '#'
          },
          {
            id: 5,
            titulo: 'Corte de suministro eléctrico en La Plata',
            descripcion: 'Falla en transformador que dejó sin luz varios barrios céntricos.',
            fecha: '2025-09-03',
            ubicacion: 'La Plata, Provincia de Buenos Aires',
            estado: 'Resuelto',
            actualizado: 'hace 30 min',
            lat: -34.9214,
            lng: -57.9545,
            detalleUrl: '#'
          },
          {
            id: 6,
            titulo: 'Inundación por tormenta en Mar del Plata',
            descripcion: 'Anegamientos en barrios bajos por intensa lluvia y desborde de desagües.',
            fecha: '2025-07-28',
            ubicacion: 'Mar del Plata, Buenos Aires',
            estado: 'En seguimiento',
            actualizado: 'hace 6 horas',
            lat: -38.0055,
            lng: -57.5426,
            detalleUrl: '#'
          },
          {
            id: 7,
            titulo: 'Deslizamiento en Mendoza',
            descripcion: 'Pequeño deslizamiento en ruta provincial que interrumpe tránsito local.',
            fecha: '2025-08-20',
            ubicacion: 'Mendoza, Mendoza',
            estado: 'Activo',
            actualizado: 'hace 1 hora',
            lat: -32.8895,
            lng: -68.8458,
            detalleUrl: '#'
          },
          {
            id: 8,
            titulo: 'Incidente de salud pública en Salta',
            descripcion: 'Aumento de consultas por gastroenteritis en un barrio periférico.',
            fecha: '2025-08-30',
            ubicacion: 'Salta, Salta',
            estado: 'En verificación',
            actualizado: 'hace 4 horas',
            lat: -24.7821,
            lng: -65.4232,
            detalleUrl: '#'
          },
          {
            id: 9,
            titulo: 'Choque múltiple en San Miguel de Tucumán',
            descripcion: 'Varios vehículos involucrados, intervención de emergencias.',
            fecha: '2025-09-01',
            ubicacion: 'San Miguel de Tucumán, Tucumán',
            estado: 'Finalizado',
            actualizado: 'hace 20 min',
            lat: -26.8083,
            lng: -65.2176,
            detalleUrl: '#'
          },
          {
            id: 10,
            titulo: 'Corte de ruta por obras en Neuquén',
            descripcion: 'Desvío temporal y obras de mantenimiento en la RN con retardos.',
            fecha: '2025-08-25',
            ubicacion: 'Neuquén, Neuquén',
            estado: 'En curso',
            actualizado: 'hace 3 horas',
            lat: -38.9517,
            lng: -68.0599,
            detalleUrl: '#'
          },
          {
            id: 11,
            titulo: 'Incidente marítimo cercano a Ushuaia',
            descripcion: 'Aviso por embarcación averiada; Prefectura realiza apoyo.',
            fecha: '2025-08-05',
            ubicacion: 'Ushuaia, Tierra del Fuego',
            estado: 'Resuelto',
            actualizado: 'hace 1 día',
            lat: -54.8019,
            lng: -68.3030,
            detalleUrl: '#'
          },
          {
            id: 12,
            titulo: 'Accidente vial en Bahía Blanca',
            descripcion: 'Choque en avenida principal; cortes y desvíos momentáneos.',
            fecha: '2025-09-04',
            ubicacion: 'Bahía Blanca, Buenos Aires',
            estado: 'Finalizado',
            actualizado: 'hace 10 min',
            lat: -38.7230,
            lng: -62.2686,
            detalleUrl: '#'
          },
          {
            id: 13,
            titulo: 'Inundaciones en Corrientes',
            descripcion: 'Suba de nivel en ríos que afecta zonas ribereñas y exige evacuaciones.',
            fecha: '2025-08-18',
            ubicacion: 'Corrientes, Corrientes',
            estado: 'Activo',
            actualizado: 'hace 45 min',
            lat: -27.4806,
            lng: -58.8342,
            detalleUrl: '#'
          }
        ];

        // ======= Inicializar mapa Leaflet =======
        const map = L.map('map').setView([-34.626, -58.426], 5); // vista inicial para mostrar varios puntos
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // marcador por cada hecho
        const markers = {};
        hechos.forEach(h => {
          const mk = L.marker([h.lat, h.lng]).addTo(map);

          // contenido del popup (botón con id único para poder capturar el click)
          const popupHtml = `
            <div>
              <div class="popup-title">${h.titulo}</div>
              <div style="font-size:0.9rem; margin-bottom:6px;">${h.ubicacion} • ${h.fecha}</div>
              <div style="font-size:0.85rem; margin-bottom:8px;">${h.descripcion}</div>
              <button id="popupBtn-${h.id}" class="btn btn-sm btn-primary">Ver detalles</button>
            </div>
          `;
          mk.bindPopup(popupHtml);

          // cuando el popup se abre, agrego el event listener al botón dentro del popup
          mk.on('popupopen', () => {
            // el DOM del popup se inyecta, así que podemos buscar el botón por id
            const btn = document.getElementById(`popupBtn-${h.id}`);
            if (btn) {
              btn.addEventListener('click', (ev) => {
                ev.preventDefault();
                abrirDetalleModal(h);
              });
            }
          });

          // también al click del marcador centro y dejo el popup
          mk.on('click', () => {
            map.setView([h.lat, h.lng], 12, { animate: true });
          });

          markers[h.id] = mk;
        });

        // ======= Función para abrir modal con detalles =======
        function abrirDetalleModal(h) {
          const body = document.getElementById('detalleModalBody');
          body.innerHTML = `
            <h5>${h.titulo}</h5>
            <p><strong>Fecha:</strong> ${h.fecha}</p>
            <p><strong>Ubicación:</strong> ${h.ubicacion}</p>
            <p><strong>Estado:</strong> ${h.estado}</p>
            <p>${h.descripcion}</p>
            <p><strong>Última actualización:</strong> ${h.actualizado}</p>
            <p><strong>Coordenadas:</strong> ${h.lat.toFixed(6)}, ${h.lng.toFixed(6)}</p>
          `;
          const btnIr = document.getElementById('btnIrADetalle');
          btnIr.href = h.detalleUrl || '#';

          // mostrar modal (Bootstrap)
          const modalEl = document.getElementById('detalleModal');
          const modal = new bootstrap.Modal(modalEl);
          modal.show();
        }

        // ======= Botones "Ver en Mapa" en las cards =======
        document.querySelectorAll('.ver-en-mapa').forEach(btn => {
          btn.addEventListener('click', (ev) => {
            const id = parseInt(btn.getAttribute('data-id'));
            const h = hechos.find(x => x.id === id);
            if (!h) return;
            map.setView([h.lat, h.lng], 12, { animate: true });
            // abrir el popup del marcador
            if (markers[id]) markers[id].openPopup();
            // opcional: abrir el modal con detalle
            // abrirDetalleModal(h);
          });
        });

        // ======= Ejemplo: si en el futuro cargás desde backend, reemplazar hechos por fetch =======
        /*
        fetch('/api/hechos?limit=100')
          .then(r => r.json())
          .then(data => {
             // reasignar hechos, crear/actualizar marcadores, etc.
          })
        */
    </script>
</div>

    <script src="/js/include-footer.js" defer></script>
</body>

</html>
