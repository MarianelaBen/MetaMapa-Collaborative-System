<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="layout" >
<head>
    <title th:text="${titulo}"></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" th:href="@{/css/base.css}" />
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <link rel="stylesheet" th:href="@{/css/footer.css}" />

    <!-- Inclusi贸n de CSS espec铆fico de la p谩gina -->
    <div th:replace="${css} :: css"></div>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />


</head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<!--Para los popups-->
<script th:if="${mensaje}">
    document.addEventListener('DOMContentLoaded', function () {
        var el = document.getElementById('flashToast');
        if (el && window.bootstrap && bootstrap.Toast) {
            new bootstrap.Toast(el, { delay: 4000 }).show();
        }
    });
</script>

<body>

<header class="main-header --public">
    <a class="logo" th:href="@{/inicio}" aria-label="Ir al inicio"> MetaMapa</a>
    <nav>
        <ul>
            <li><a th:href="@{/inicio}">Inicio</a></li>
            <li><a th:href="@{/colecciones}">Colecciones</a></li>
            <li><a th:href="@{/hechos/nuevo}">Contribuir</a></li>

            <li sec:authorize="isAuthenticated()">
                <a th:href="@{/hechos/mis-hechos}">Mis Hechos</a>
            </li>

            <li sec:authorize="!isAuthenticated()">
                <a th:href="@{/login}">Iniciar Sesi贸n</a>
            </li>


            <!-- Dropdown visible solo para administradores -->
            <li sec:authorize="hasRole('ADMIN')" class="dropdown admin-menu">
                <button class="dropdown-toggle" id="adminMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fa-solid fa-user-gear"></i> Administrador
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="adminMenuButton">
                    <li><a class="dropdown-item" th:href="@{/admin/panel-control}">Panel de control</a></li>
                    <li><a class="dropdown-item" th:href="@{/admin/gestor-solicitudes}">Solicitudes de Eliminaci贸n</a></li>
                    <li><a class="dropdown-item" th:href="@{/admin/solicitudes-edicion}">Solicitudes de Modificaci贸n</a></li>
                    <li><a class="dropdown-item" th:href="@{/admin/gestor-hechos}">Gestor de hechos</a></li>
                    <li><a class="dropdown-item" th:href="@{/admin/estadisticas}">Estad铆sticas</a></li>

                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <form th:action="@{/logout}" method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button type="submit" class="dropdown-item text-danger">
                                <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesi贸n
                            </button>
                        </form>
                    </li>
                </ul>
            </li>


            <li sec:authorize="isAuthenticated() and !hasRole('ADMIN')" style="color:#fff; opacity:.9;">
                Hola, <span sec:authentication="name"></span>
            </li>
            <li sec:authorize="isAuthenticated() and !hasRole('ADMIN')" style="list-style:none;">
                <form th:action="@{/logout}" method="post" style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesi贸n
                    </button>
                </form>
            </li>
        </ul>
    </nav>
</header>


<style>
    .admin-menu {
        position: relative;
        margin-left: auto;
    }


    .dropdown-toggle {
        background: transparent;
        border: none;
        color: white;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
    }


    .dropdown-menu {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        margin-top: 10px;
        min-width: 200px;
    }

    .admin-menu .dropdown-menu {
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        margin-top: 10px;
        min-width: 220px;
        padding: 0.5rem 0;
    }


    .admin-menu .dropdown-item {
        color: #333 !important;
        font-weight: 500;
        background-color: transparent;
        transition: background-color 0.2s ease, color 0.2s ease;
    }


    .admin-menu .dropdown-item:hover {
        background-color: #f0f4ff;
        color: #004080 !important;
    }


    .admin-menu .dropdown-divider {
        margin: 0.3rem 0;
        border-color: #ddd;
    }

    .admin-menu .dropdown-menu.show .dropdown-item {
        color: #333 !important;
    }

    .admin-menu .dropdown-toggle {
        color: #fff;
        font-weight: 600;
        background: none;
        border: none;
    }


    .admin-menu .dropdown-toggle:hover,
    .admin-menu .dropdown-toggle:focus {
        color: #f0f4ff;
    }

    .admin-menu .dropdown-menu {
        display: none;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.15s ease, visibility 0.15s ease;
    }

    .admin-menu .dropdown-menu.show {
        display: block;
        opacity: 1;
        visibility: visible;
    }

    .admin-menu {
        position: relative;
    }


    .admin-menu .dropdown-toggle::after {
        margin-left: 6px;
    }

</style>


    <div th:replace="${contenido} :: contenido"></div>


<!-- Para popups -->
<div aria-live="polite" aria-atomic="true" class="position-fixed top-0 end-0 p-3" style="z-index:1100;"
     th:if="${mensaje}">
    <div id="flashToast"
         class="toast align-items-center"
         role="alert" aria-live="assertive" aria-atomic="true"
         th:classappend="${tipoMensaje}=='success' ? ' text-bg-success' : ' text-bg-danger'">
        <div class="d-flex">
            <div class="toast-body" th:text="${mensaje}">Operaci贸n realizada.</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
        </div>
    </div>
</div>

<footer class="site-footer">
    <div class="footer-container">
        <!-- Columna 1 -->
        <div class="footer-col">
            <h4>Informaci贸n</h4>
            <ul>
                <li><a th:href="@{/privacidad}">Informaci贸n Legal & Privacidad</a></li>
                <li><a href="#">Preguntas Frecuentes</a></li>
            </ul>
        </div>

        <!-- Columna 2 -->
        <div class="footer-col">
            <h4>Contacto</h4>
            <ul class="contact-list">
                <li><i class="fa-regular fa-envelope"></i>
                    <a href="mailto:info@metamapa.com">info@metamapa.com</a>
                </li>
                <li><i class="fa-solid fa-phone"></i>
                    <a href="tel:+1234567890">+11 3456 7890</a>
                </li>
                <li class="muted">Horario: Lunes - Viernes, 9:00 - 17:00</li>
            </ul>
        </div>

        <!-- Columna 3 -->
        <div class="footer-col">
            <h4>Seguinos</h4>
            <div class="socials">
                <a href="#" aria-label="Facebook"><i class="fa-brands fa-facebook-f"></i></a>
                <a href="#" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
                <a href="#" aria-label="LinkedIn"><i class="fa-brands fa-linkedin-in"></i></a>
            </div>
        </div>

        <!-- Columna 4 -->
        <div class="footer-col">
            <h4>MetaMapa</h4>
            <p class="about">Ofreciendo soluciones innovadoras para un futuro conectado.</p>
            <p class="muted">漏 2025 MetaMapa. Todos los derechos reservados.</p>
        </div>
    </div>
</footer>

</body>
</html>