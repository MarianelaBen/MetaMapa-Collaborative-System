<html th:replace="~{layout/base :: layout}" xmlns:th="http://www.thymeleaf.org">

<div th:fragment="css">
  <link rel="stylesheet" th:href="@{/css/importadorArchivosCSV.css}" />
</div>

<div th:fragment="contenido" class="container">

    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a th:href="@{/admin/gestor-hechos}">Panel de Control</a> ›
      Importar Hechos CSV
    </div>

    <!-- Page Header -->
    <div class="page-header">
      <div class="header-gradient">
        <h1 class="page-title" th:text="${titulo}">Importación de Hechos en Archivos CSV</h1>
        <p class="page-subtitle">Procesa archivos CSV con más de 10,000 registros</p>
      </div>
    </div>

    <div class="alert alert-success" th:if="${mensaje}" th:text="${mensaje}"></div>
    <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>
    <div class="alert alert-info" th:if="${detalle}" th:text="${detalle}"></div>

    <div class="results-summary" th:if="${hechosTotales}">
      <div class="result-card success">
        <div class="result-icon"><i class="fas fa-database"></i></div>
        <div class="result-number" th:text="${hechosTotales}">0</div>
        <div class="result-label">Hechos Totales</div>
      </div>
      <div class="result-card success">
        <div class="result-icon"><i class="fas fa-check-circle"></i></div>
        <div class="result-number" th:text="${guardadosTotales}">0</div>
        <div class="result-label">Guardados</div>
      </div>
      <div class="result-card warning">
        <div class="result-icon"><i class="fas fa-clock"></i></div>
        <div class="result-number" th:text="${tiempoTardado}">0</div>
        <div class="result-label">Tiempo (ms)</div>
      </div>
    </div>

      <!-- Wizard Content -->
  <form th:action="@{/admin/importarCSV}" method="post" enctype="multipart/form-data" class="wizard-content">
    <input type="hidden"
           th:if="${_csrf != null}"
           th:name="${_csrf.parameterName}"
           th:value="${_csrf.token}"/>
        <!-- Step 1: Upload File -->
        <div class="step-content active" id="step-1">
          <div class="upload-area" id="uploadArea">
            <div class="upload-icon">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="upload-text">Arrastra tu archivo CSV aquí</div>
            <div class="upload-subtext">o haz clic para seleccionar el archivo</div>
            <button class="upload-btn" type="button" onclick="document.getElementById('csvFileInput').click()">
              <i class="fas fa-file-upload"></i>
              Seleccionar Archivo CSV
            </button>
            <input type="file" id="csvFileInput" name="archivo" accept=".csv" />
            <div style="margin-top: 1rem; color: #6b7280; font-size: 0.9rem;">
              <strong>Formatos soportados:</strong> CSV (máx. 100MB)<br>
              <strong>Registros recomendados:</strong> 10,000+ entradas
            </div>
          </div>

          <div class="file-info" id="fileInfo">
            <div class="file-details">
              <div class="file-name" id="fileName">archivo.csv</div>
              <div class="file-size" id="fileSize">15.2 MB</div>
            </div>
            <div class="file-stats">
              <div class="stat-item">
                <div class="stat-number" id="totalRows">12,340</div>
                <div class="stat-label">Filas detectadas</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="totalColumns">8</div>
                <div class="stat-label">Columnas</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="fileFormat">UTF-8</div>
                <div class="stat-label">Codificación</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="delimiter">,</div>
                <div class="stat-label">Separador</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Configuration -->
        <div class="step-content" id="step-2">
          <div class="config-section">
            <div class="config-title">
              <i class="fas fa-cog"></i>
              Configuración de Importación
            </div>
            <div class="config-grid">
              <div class="config-card">
                <div class="card-header">
                  <i class="fas fa-file-csv"></i>
                  Opciones del Archivo
                </div>
                <div class="form-group">
                  <label class="form-label">Separador de campos</label>
                  <select class="form-control" id="delimiterSelect" name="delimiter">
                    <option value=",">Coma (,)</option>
                    <option value=";">Punto y coma (;)</option>
                    <option value="\t">Tabulación</option>
                    <option value="|">Barra vertical (|)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Codificación de caracteres</label>
                  <select class="form-control" id="encoding">
                    <option value="utf-8">UTF-8</option>
                    <option value="iso-8859-1">ISO-8859-1</option>
                    <option value="windows-1252">Windows-1252</option>
                  </select>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" id="hasHeader" checked>
                  <label for="hasHeader">Primera fila contiene encabezados</label>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" id="skipEmpty" checked>
                  <label for="skipEmpty">Omitir filas vacías</label>
                </div>
              </div>

              <div class="config-card">
                <div class="card-header">
                  <i class="fas fa-database"></i>
                  Opciones de Procesamiento
                </div>
                <div class="form-group">
                  <label class="form-label">Tamaño de lote (registros por lote)</label>
                  <select class="form-control" id="batchSize">
                    <option value="1000">1,000 registros</option>
                    <option value="2500" selected>2,500 registros</option>
                    <option value="5000">5,000 registros</option>
                    <option value="10000">10,000 registros</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Acción en caso de duplicados</label>
                  <select class="form-control" id="duplicateAction">
                    <option value="skip">Omitir duplicados</option>
                    <option value="update">Actualizar existentes</option>
                    <option value="create">Crear como nuevos</option>
                  </select>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" id="validateData" checked>
                  <label for="validateData">Validar datos antes de importar</label>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" id="generateReport" checked>
                  <label for="generateReport">Generar reporte detallado</label>
                </div>
              </div>
            </div>
          </div>

            <!-- no se que es esto pero tiraba error
            <div class="field-mapping">
              <div class="config-title">
                <i class="fas fa-arrows-alt"></i>
                Mapeo de Campos
              </div>
              <div class="mapping-row">
                <div class="csv-field">titulo</div>
                <select class="form-control"> -->

        </div>
    <div class="wizard-navigation">
      <button type="submit" class="nav-btn btn-import">
        <i class="fas fa-upload"></i> Importar CSV
      </button>
    </div>
   </form>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var input = document.getElementById('csvFileInput');
      var fileInfo = document.getElementById('fileInfo');
      var fileNameEl = document.getElementById('fileName');
      var fileSizeEl = document.getElementById('fileSize');

      if (!input) return;
      input.addEventListener('change', function (e) {
        var file = e.target.files && e.target.files[0];
        if (file) {
          fileNameEl.textContent = file.name;
          fileSizeEl.textContent = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
          fileInfo.classList.add('show');
        } else {
          fileInfo.classList.remove('show');
        }
      });
    });
  </script>

</div>

</html>
