<!--/*@thymesVar id="hecho" type="ar.utn.ba.ddsi.Metamapa.dtos.HechoDTO"*/-->
<!--/*@thymesVar id="categorias" type="java.util.List<java.lang.String>"*/-->

<html th:replace="~{layout/base :: layout}" xmlns:th="http://www.thymeleaf.org">

<div th:fragment="css">
    <link rel="stylesheet" th:href="@{/css/editorHechos.css}" />
</div>

<div class="container" th:fragment="contenido">

    <div class="breadcrumb">
        <a th:href="@{/misHechos}"> Mis Hechos </a> ‚Ä∫
        <span>Edici√≥n del Hecho</span>
    </div>

    <div class="alert alert-danger" th:if="${errorMsg}">
        <strong>Atenci√≥n:</strong> <span th:text="${errorMsg}">Hay campos obligatorios sin completar.</span>
    </div>

    <!-- Formulario de edici√≥n -->
    <form th:action="@{/hechos/{id}/editar(id=${hechoId})}"
          th:object="${hecho}"
          method="post"
          enctype="multipart/form-data">

        <div class="fact-container">
            <div class="fact-main">
                <div class="fact-header">
                    <div class="editable-line">
                        <textarea class="fact-title-input"
                           th:field="*{titulo}"
                           rows="2"
                           placeholder="T√≠tulo del hecho"
                                  required></textarea>
                        <button class="btn-editar" type="button" title="Editar">
                            <i class="fa-solid fa-pen"></i>
                        </button>
                    </div>

                        <select class="fact-category" th:field="*{categoria}" required>
                            <option th:each="cat : ${categorias}"
                                    th:value="${cat}"
                                    th:text="${cat}">
                            </option>
                        </select>

                    <!-- Estado visual (opcional, solo decorativo por ahora) -->
                    <div class="fact-status" style="margin-top: .75rem;">
                        <div class="consensus-indicator">
                            <div class="consensus-dot consensus-verified"></div>
                            <span><strong>Estado:</strong> Verificado por consenso</span>
                        </div>
                    </div>
                </div>

                <div class="fact-content">
                    <section>
                        <h3 class="section-title">
                            Descripci√≥n
                            <button class="btn-editar" type="button" title="Editar">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                        </h3>

                        <textarea class="fact-description"
                                  th:field="*{descripcion}"
                                  rows="6"
                                  placeholder="Describe el hecho con el mayor detalle posible..."
                                  required></textarea>
                    </section>

                    <!-- Multimedia -->
                    <section class="multimedia-section">
                        <h3 class="multimedia-title">Contenido Multimedia</h3>

                        <!-- listado simple de archivos ya adjuntos -->
                        <div class="multimedia-grid"
                             th:if="${hecho.idContenidoMultimedia != null and !#lists.isEmpty(hecho.idContenidoMultimedia)}">
                            <div class="multimedia-item"
                                 th:each="path : ${hecho.idContenidoMultimedia}">
                                <div class="multimedia-placeholder"
                                     th:text="${#strings.substringAfterLast(path,'/')}">archivo.jpg</div>
                            </div>
                        </div>

                        <!-- agregar nuevos archivos -->
                        <div style="margin-top: .75rem;">
                            <input type="file" name="multimedia" multiple />
                            <small class="text-muted" style="display:block;margin-top:.25rem;">
                                Pod√©s seleccionar varias im√°genes/videos a la vez.
                            </small>
                        </div>
                    </section>

                    <!-- Acciones -->
                    <div style="display:flex; gap:.75rem; flex-wrap:wrap;">
                        <button type="submit" class="btn btn-success">Guardar Cambios</button>
                        <a th:href="@{/hechos/{id}(id=${hechoId})}" class="btn btn-secondary">Cancelar</a>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="fact-sidebar">
                <!-- Info b√°sica -->
                <div class="info-card">
                    <h3>Informaci√≥n B√°sica</h3>

                    <table class="metadata-table">
                        <tr>
                            <td>Fecha del acontecimiento:</td>
                            <td class="editable-cell">
                                <input type="date"
                                       name="fecha"
                                       th:value="${hecho.fechaAcontecimiento != null ? #temporals.format(hecho.fechaAcontecimiento,'yyyy-MM-dd') : ''}"
                                       required/>
                                <button class="btn-editar" type="button" title="Editar">
                                    <i class="fa-solid fa-pen"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                        <tr>
                            <td>Hora del acontecimiento:</td>
                            <td class="editable-cell">
                                <input type="time"
                                       name="hora"
                                       th:value="${hecho.fechaAcontecimiento != null ? #temporals.format(hecho.fechaAcontecimiento,'HH:mm') : ''}"
                                       required/>
                                <button class="btn-editar" type="button" title="Editar">
                                    <i class="fa-solid fa-pen"></i>
                                </button>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Ubicaci√≥n -->
                <div class="info-card">
                    <h3>Ubicaci√≥n</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Provincia</span>
                            <div class="editable-line">
                                <input class="info-value" th:field="*{provincia}" placeholder="Provincia"
                                       required/>
                                <button class="btn-editar" type="button" title="Editar">
                                    <i class="fa-solid fa-pen"></i>
                                </button>
                            </div>
                        </div>

                    <div class="location-map">
                        <div>
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üó∫Ô∏è</div>
                            <p>Mapa de referencia<br/> (pendiente de integrar)</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>

    <div class="return-bar">
        <a th:href="@{/misHechos}" class="return-link">‚Üê Volver a Mis Hechos</a>
    </div>


</div>
</html>